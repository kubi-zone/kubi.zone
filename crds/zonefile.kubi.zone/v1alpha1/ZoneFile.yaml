---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: zonefiles.zonefile.kubi.zone
spec:
  group: zonefile.kubi.zone
  names:
    categories: []
    kind: ZoneFile
    plural: zonefiles
    shortNames: []
    singular: zonefile
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.zoneRef.name
      name: zone
      type: string
    - jsonPath: .spec.serial
      name: serial
      type: string
    - jsonPath: .status.hash
      name: hash
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ZoneFileSpec via `CustomResource`
        properties:
          spec:
            description: A [`ZoneFile`] references an upstream [`Zone`](kubizone_crds::Zone) and (re)builds a configmap of the same name, whenever the zone changes, automatically incrementing serials as necessary.
            properties:
              expire:
                default: 3600000
                description: |-
                  Number of seconds after which secondary name servers should stop answering request for this zone if the master does not respond.

                  This value must be bigger than the sum of Refresh and Retry.

                  Recommendation for small and stable zones[^1]: 3600000 seconds (1000 hours)

                  [^1]: <https://www.ripe.net/publications/docs/ripe-203>
                format: uint32
                minimum: 0.0
                type: integer
              negativeResponseCache:
                default: 360
                description: |-
                  Used in calculating the time to live for purposes of negative caching. Authoritative name servers take the smaller of the SOA TTL and the SOA MINIMUM to send as the SOA TTL in negative responses.

                  Resolvers use the resulting SOA TTL to understand for how long they are allowed to cache a negative response.

                  Recommendation for small and stable zones[^1] 172800 seconds (2 days)

                  [^1]: <https://www.ripe.net/publications/docs/ripe-203>
                format: uint32
                minimum: 0.0
                type: integer
              refresh:
                default: 86400
                description: |-
                  Number of seconds after which secondary name servers should query the master for the SOA record, to detect zone changes.

                  Recommendation for small and stable zones[^1]: 86400 seconds (24 hours).

                  [^1]: <https://www.ripe.net/publications/docs/ripe-203>
                format: uint32
                minimum: 0.0
                type: integer
              retry:
                default: 7200
                description: |-
                  Number of seconds after which secondary name servers should retry to request the serial number from the master if the master does not respond.

                  It must be less than Refresh.

                  Recommendation for small and stable zones[^1]: 7200 seconds (2 hours).

                  [^1]: <https://www.ripe.net/publications/docs/ripe-203>
                format: uint32
                minimum: 0.0
                type: integer
              serial:
                default: 1
                description: |-
                  Serial of the latest generated zonefile.

                  The zonefile controller will automatically increment this value whenever the zonefile configmap is rebuilt, in accordance with [RFC 1912](https://datatracker.ietf.org/doc/html/rfc1912#section-2.2)
                format: uint32
                minimum: 0.0
                type: integer
              ttl:
                default: 360
                description: Time-to-Live. Represents how long (in seconds) recursive resolvers should keep this record in their cache.
                format: uint32
                minimum: 0.0
                type: integer
              zoneRef:
                description: Reference to a [`Zone`](kubizone_crds::Zone), optionally in a different namespace.
                properties:
                  name:
                    type: string
                  namespace:
                    nullable: true
                    type: string
                required:
                - name
                type: object
            required:
            - zoneRef
            type: object
          status:
            description: Describes the current state of the [`ZoneFile`], tracks state of the upstream [`Zone`](kubizone_crds::Zone), to determine when the output `ConfigMap` should be re-generated.
            nullable: true
            properties:
              hash:
                description: |-
                  Last observed hash of the upstream [`Zone`](kubizone_crds::Zone)

                  Used by the zonefile controller to trigger configmap rebuilds and zone serial rotation.
                nullable: true
                type: string
            type: object
        required:
        - spec
        title: ZoneFile
        type: object
    served: true
    storage: true
    subresources:
      status: {}
